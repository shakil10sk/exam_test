var trade_table,from_date,to_date,trade_certi_table,fiscal_year,prev_certi_table,table,pesha_kors,url=$("meta[name = path]").attr("content"),csrf=$("mata[name = csrf-token]").attr("content");
function calculation(){$("#vat").val(""),$("#total").val("");var a,t,e=$("#fee").val(),n=$("#due").val(),r=$("#discount").val(),o=$("#signbord_vat").val(),l=$("#pesha_vat").val(),_=$("#sarcharge").val();n>0&&(e=parseInt(e)+parseInt(n)),r>0&&(e=parseInt(e)-parseInt(r)),t=15*e/100,o>0&&(e=parseInt(e)+parseInt(o)),l>0&&(e=parseInt(e)+parseInt(l)),_>0&&(e=parseInt(e)+parseInt(_)),a=parseInt(e)+parseInt(t),$("#vat").val(t),$("#total").val(a)}function trade_applicant_list(){from_date=$("#from_date").val(),to_date=$("#to_date").val(),trade_table=$("#trade_applicant_table").DataTable({scrollCollapse:!0,autoWidth:!1,responsive:!0,serverSide:!0,processing:!0,ajax:{dataType:"JSON",type:"post",url:trade_applicant_data_url,data:{from_date:from_date,to_date:to_date,_token:trade_applicant_csrf}},columns:[{data:null,render:function(){return trade_table.page.info().start+trade_table.column(0).nodes().length}},{data:null,render:function(a,t,e){return"<a class='link_color' href='edit/"+a.tracking+"'>"+a.organization_name_bn+"</a>"}},{data:"tracking"},{data:null,render:function(a,t,e){return 1==a.owner_type?"ব্যক্তিগত":2==a.owner_type?"যৌথ":"কোম্পানি"}},{data:null,render:function(a,t,e){return 1==a.business_type?"পাইকারি বিক্রেতা":2==a.business_type?"খুচরা বিক্রেতা":3==a.business_type?"মুদি":4==a.business_type?"কনফেকশনারি":5==a.business_type?"মনোহরি":6==a.business_type?"ফার্মেসি":"---"}},{data:"mobile"},{data:"email"},{data:"created_time"},{data:null,render:function(a,t,e,n){var r="",o="",l="";return $("#generate").val()&&(l="<a  href='javascript:void(0)' onclick='trade_generate("+n.row+")' ><p class='btn btn-sm btn-primary'>জেনারেট</p></a> "),$("#edit").val()&&(r="<a  href='edit/"+a.tracking+"'><p class='btn btn-sm btn-warning'>এডিট</p></a> "),$("#delete").val()&&(o="<a  href='javascript:void(0)'><p class='btn btn-sm btn-danger' onclick='trade_delete("+a.tracking+")' >ডিলিট</p></a> "),l+r+"<a  href='preview/"+a.tracking+"' target='_blank'><p class='btn btn-sm btn-success'>আবেদন প্র্রিন্ট</p></a> "+o}}],columnDefs:[{targets:"datatable-nosort",orderable:!1}],lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],language:{info:"_START_-_END_ of _TOTAL_ entries",searchPlaceholder:"Search"},dom:"Bfrtip",buttons:["copy","csv","pdf","print"]})}function applicant_list_search(){from_date=$("#from_date").val(),to_date=$("#to_date").val(),$("#trade_applicant_table").dataTable().fnSettings().ajax.data.from_date=from_date,$("#trade_applicant_table").dataTable().fnSettings().ajax.data.to_date=to_date,trade_table.ajax.reload()}function account_list(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$.ajax({url:url+"/global/account_list",type:"POST",dataType:"JSON",data:{},success:function(a){var t;"success"==a.status&&(a.data.forEach((function(a){28==a.id?t+='<option value ="'+a.id+'"> ট্রেড লাইসেন্স</option>':t+='<option value ="'+a.id+'">'+a.account_name+"</option>"})),$("#account").html(t))}})}function trade_generate(a){$("#fee").val(""),$("#due").val(""),$("#due_fiscal_year").val(""),$("#discount").val(""),$("#vat").val(""),$("#signbord_vat").val(""),$("#pesha_vat").val(""),$("#sarcharge").val(""),$("#total").val("");var t=trade_table.row(a).data();account_list(),$("#tracking").val(t.tracking),$("#organization_name_bn").val(t.organization_name_bn),1==t.owner_type?$("#owner_type").val("ব্যক্তিগত"):2==t.owner_type?$("#owner_type").val("যৌথ"):$("#owner_type").val("কোম্পানি"),$("#business_type").val(t.business_type_bn),$("#application_id").val(t.application_id),$("#union_id").val(t.union_id),$("#upazila_id").val(t.trade_upazila_id),$("#district_id").val(t.trade_district_id),$("#trade_generate_modal").modal("show")}function generate_save(){var a=$("#tracking").val(),t=$("#expire_date").val(),e=$("#issue_date").val(),n=$("#payment_date").val(),r=$("#due_fiscal_year").val(),o=$("#application_id").val(),l=$("#union_id").val(),_=$("#upazila_id").val(),s=$("#district_id").val(),i=$("#account").val(),d=$("#fee").val(),c=$("#due").val(),u=$("#discount").val(),p=$("#vat").val(),f=$("#signbord_vat").val(),v=$("#pesha_vat").val(),m=$("#sarcharge").val(),b=$("#total").val(),h=!1;if(null==d||d<1?($("#fee_error").html("লাইসেন্স ফি দিতে হবে"),h=!0):$("#fee_error").html(""),c>0&&""==r?($("#due_fiscal_year_error").html("বকেয়া অর্থ বছর দিতে হবে"),h=!0):$("#due_fiscal_year_error").html(""),0!=h)return!1;swal({title:"মোট "+b+" টাকা",text:"আপনি কি সনদটি জেনারেট করতে চান ?",type:"warning",showConfirmButton:!0,confirmButtonClass:"btn-success",confirmButtonText:"হ্যাঁ",showCancelButton:!0,cancelButtonText:"না",showLoaderOnConfirm:!0,preConfirm:function(){$.ajax({url:url+"/trade/generate",type:"POST",dataType:"JSON",data:{tracking:a,due_fiscal_year:r,expire_date:t,issue_date:e,payment_date:n,union_id:l,upazila_id:_,district_id:s,application_id:o,credit_id:i,fee:d,due:c,discount:u,vat:p,signbord_vat:f,pesha_vat:v,sarcharge:m,total:b,_token:trade_generate_csrf},success:function(a){$("#trade_generate_modal").modal("hide"),swal({title:"ধন্যবাদ",text:a.message,type:a.status,showCancelButton:!0,cancelButtonText:"বাতিল",showConfirmButton:!0,confirmButtonText:'<a href="'+trade_bangla_sonod_url+"/"+a.sonod_no+'" target="_blank">প্রিন্ট</a>',closeOnConfirm:!0,allowEscapeKey:!1}),trade_table.ajax.reload()}})}}).then((function(){}))}function trade_delete(a){swal({title:"অনুমোদন",text:"আপনি কি আবেদনটি ডিলিট করতে চান ?",type:"warning",showConfirmButton:!0,confirmButtonClass:"btn-success",confirmButtonText:"হ্যাঁ",showCancelButton:!0,cancelButtonText:"না",showLoaderOnConfirm:!0,preConfirm:function(){$.ajax({url:trade_delete_url,type:"POST",dataType:"JSON",data:{tracking:a,_token:trade_delete_csrf},success:function(a){swal({title:"মোছা হয়েছে!",text:a.message,type:a.status,showCancelButton:!1,showConfirmButton:!0,confirmButtonText:"ঠিক আছে",closeOnConfirm:!0,allowEscapeKey:!1}),trade_table.ajax.reload()}})}}).then((function(){}))}function trade_certificate_list(){from_date=$("#from_date").val(),to_date=$("#to_date").val(),trade_certi_table=$("#trade_certificate_table").DataTable({scrollCollapse:!0,autoWidth:!1,responsive:!0,serverSide:!0,processing:!0,ajax:{dataType:"JSON",type:"post",url:trade_certificate_data_url,data:{from_date:from_date,to_date:to_date,_token:trade_certificate_csrf}},columns:[{data:null,render:function(){return trade_certi_table.page.info().start+trade_certi_table.column(0).nodes().length}},{data:null,render:function(a,t,e){return"<a class='link_color' href='edit/"+a.tracking+"'>"+a.organization_name_bn+"</a>"}},{data:"tracking"},{data:"sonod_no"},{data:null,render:function(a,t,e){return 1==a.owner_type?"ব্যক্তিগত":2==a.owner_type?"যৌথ":"কোম্পানি"}},{data:null,render:function(a,t,e){return"পাইকারি"}},{data:"mobile"},{data:"email"},{data:"generate_date"},{data:null,render:function(a,t,e,n){var r="",o="";return $("#regenerate").val()&&"<a  href='javascript:void(0)' onclick='trade_regenerate("+n.row+")' ><p class='btn btn-sm btn-primary custom_button'>রি-জেনারেট</p></a> ",$("#edit").val()&&(r="<a  href='edit/"+a.tracking+"'><p class='btn btn-sm btn-warning' >এডিট</p></a> "),$("#invoice").val()&&(o="<a  href='money_receipt/"+a.sonod_no+"' target='_blank'><p class='btn btn-sm custom_button_violet'>রশিদ</p></a>"),"<a  href='print_bn/"+a.sonod_no+"' target='_blank' ><p class='btn btn-sm btn-primary '>বাংলা</p></a>  <a  href='print_en/"+a.sonod_no+"' target='_blank' ><p class='btn btn-sm btn-success'>ইংরেজি</p></a> "+r+o}}],columnDefs:[{targets:"datatable-nosort",orderable:!1}],lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],language:{info:"_START_-_END_ of _TOTAL_ entries",searchPlaceholder:"Search"},dom:"Bfrtip",buttons:["copy","csv","pdf","print"]})}function certificate_list_search(){from_date=$("#from_date").val(),to_date=$("#to_date").val(),$("#trade_certificate_table").dataTable().fnSettings().ajax.data.from_date=from_date,$("#trade_certificate_table").dataTable().fnSettings().ajax.data.to_date=to_date,trade_certi_table.ajax.reload()}function previous_trade_certificate_list(){from_date=$("#from_date").val(),to_date=$("#to_date").val(),fiscal_year=$("#fiscal_year_id").val(),prev_certi_table=$("#trade_certificate_table").DataTable({scrollCollapse:!0,autoWidth:!1,responsive:!0,serverSide:!0,processing:!0,ajax:{dataType:"JSON",type:"post",url:trade_certificate_data_url,data:{from_date:from_date,to_date:to_date,fiscal_year:fiscal_year,_token:trade_certificate_csrf}},columns:[{data:null,render:function(){return prev_certi_table.page.info().start+prev_certi_table.column(0).nodes().length}},{data:null,render:function(a,t,e){return"<a class='link_color' href='edit/"+a.tracking+"'>"+a.organization_name_bn+"</a>"}},{data:"tracking"},{data:"sonod_no"},{data:null,render:function(a,t,e){return 1==a.owner_type?"ব্যক্তিগত":2==a.owner_type?"যৌথ":"কোম্পানি"}},{data:null,render:function(a,t,e){return"পাইকারি"}},{data:"mobile"},{data:"email"},{data:"generate_date"},{data:null,render:function(a,t,e,n){var r="",o="";return $("#regenerate").val()&&"<a  href='javascript:void(0)' onclick='trade_regenerate("+n.row+")' ><p class='btn btn-sm btn-primary custom_button'>রি-জেনারেট</p></a> ",$("#edit").val()&&(r="<a  href='edit/"+a.tracking+"'><p class='btn btn-sm btn-warning' >এডিট</p></a> "),$("#invoice").val()&&(o="<a  href='money_receipt/"+a.sonod_no+"' target='_blank'><p class='btn btn-sm custom_button_violet'>রশিদ</p></a>"),"<a  href='previous_print_bn/"+a.sonod_no+"/2' target='_blank' ><p class='btn btn-sm btn-primary '>বাংলা</p></a>  <a  href='previous_print_en/"+a.sonod_no+"/2' target='_blank' ><p class='btn btn-sm btn-success'>ইংরেজি</p></a> "+r+o}}],columnDefs:[{targets:"datatable-nosort",orderable:!1}],lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],language:{info:"_START_-_END_ of _TOTAL_ entries",searchPlaceholder:"Search"},dom:"Bfrtip",buttons:["copy","csv","pdf","print"]})}function previous_certificate_list_search(){from_date=$("#from_date").val(),to_date=$("#to_date").val(),fiscal_year=$("#fiscal_year_id").val(),$("#trade_certificate_table").dataTable().fnSettings().ajax.data.from_date=from_date,$("#trade_certificate_table").dataTable().fnSettings().ajax.data.to_date=to_date,$("#trade_certificate_table").dataTable().fnSettings().ajax.data.fiscal_year=fiscal_year,prev_certi_table.ajax.reload()}function ex_trade_regenerate(a){var t=$("#trade_certificate_table").DataTable().row(a).data();$("#fee").val(""),$("#due").val(""),$("#due_fiscal_year").val(""),$("#discount").val(""),$("#vat").val(""),$("#signbord_vat").val(""),$("#pesha_vat").val(""),$("#sarcharge").val(""),$("#total").val(""),$("#fee_error").html(""),$("#due_fiscal_year_error").html(""),account_list(),$("#tracking").val(t.tracking),$("#organization_name_bn").val(t.organization_name_bn),1==t.owner_type?$("#owner_type").val("ব্যক্তিগত"):2==t.owner_type?$("#owner_type").val("যৌথ"):$("#owner_type").val("কোম্পানি"),$("#business_type").val(t.business_type),$("#certificate_id").val(t.certificate_id),$("#sonod_no").val(t.sonod_no),$("#union_id").val(t.union_id),$("#upazila_id").val(t.trade_upazila_id),$("#district_id").val(t.trade_district_id),$("#trade_regenerate_modal").modal("show")}function re_generate_save(){var a=$("#tracking").val(),t=$("#sonod_no").val(),e=$("#expire_date").val(),n=$("#issue_date").val(),r=$("#payment_date").val(),o=$("#due_fiscal_year").val(),l=$("#certificate_id").val(),_=$("#union_id").val(),s=$("#upazila_id").val(),i=$("#district_id").val(),d=$("#account").val(),c=$("#fee").val(),u=$("#due").val(),p=$("#discount").val(),f=$("#vat").val(),v=$("#signbord_vat").val(),m=$("#pesha_vat").val(),b=$("#sarcharge").val(),h=$("#total").val(),g=!1;if(""==c?($("#fee_error").html("লাইসেন্স ফি দিতে হবে"),g=!0):$("#fee_error").html(""),""!=u&&""==o?($("#due_fiscal_year_error").html("বকেয়া অর্থ বছর দিতে হবে"),g=!0):$("#due_fiscal_year_error").html(""),0!=g)return!1;swal({title:"মোট "+h+" টাকা",text:"আপনি কি সনদটি রি-জেনারেট করতে চান ?",type:"warning",showConfirmButton:!0,confirmButtonClass:"btn-success",confirmButtonText:"হ্যাঁ",showCancelButton:!0,cancelButtonText:"না",showLoaderOnConfirm:!0,preConfirm:function(){$.ajax({url:url+"/trade/regenerate",type:"POST",dataType:"JSON",data:{sonod_no:t,tracking:a,due_fiscal_year:o,expire_date:e,issue_date:n,payment_date:r,union_id:_,upazila_id:s,district_id:i,certificate_id:l,credit_id:d,fee:c,due:u,discount:p,vat:f,signbord_vat:v,pesha_vat:m,sarcharge:b,total:h,_token:csrf},success:function(a){$("#trade_regenerate_modal").modal("hide"),swal({title:"ধন্যবাদ",text:a.message,type:a.status,showCancelButton:!0,cancelButtonText:"বাতিল",showConfirmButton:!0,confirmButtonText:'<a href="'+trade_bangla_sonod_url+"/"+a.sonod_no+'" target="_blank">প্রিন্ট</a>',closeOnConfirm:!0,allowEscapeKey:!1}),table.ajax.reload()}})}}).then((function(){}))}function pesha_kor_list(){from_date=$("#from_date").val(),to_date=$("#to_date").val(),pesha_kors=$("#pesha_kor_list_table").DataTable({scrollCollapse:!0,autoWidth:!1,responsive:!0,serverSide:!0,processing:!0,ajax:{dataType:"JSON",type:"post",url:url+"/trade/pesha_kor_list",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{from_date:from_date,to_date:to_date}},columns:[{data:null,render:function(){return pesha_kors.page.info().start+pesha_kors.column(0).nodes().length}},{data:"organization_name_bn"},{data:"tracking"},{data:"voucher"},{data:"sonod_no"},{data:"amount"},{data:"payment_date"},{data:null,render:function(a,t,e,n){return $("#income-tax-invoice").val()?"<a  href='peshakor_money_receipt/"+a.sonod_no+"' target='_blank'><p class='btn btn-sm custom_button_violet'>রশিদ</p></a>":""}}],columnDefs:[{targets:"datatable-nosort",orderable:!1}],lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],language:{info:"_START_-_END_ of _TOTAL_ entries",searchPlaceholder:"Search"},dom:"Bfrtip",buttons:["copy","csv","pdf","print"]})}function pesha_kor_list_search(){from_date=$("#from_date").val(),to_date=$("#to_date").val(),$("#pesha_kor_list_table").dataTable().fnSettings().ajax.data.from_date=from_date,$("#pesha_kor_list_table").dataTable().fnSettings().ajax.data.to_date=to_date,pesha_kors.ajax.reload()}function collect_pesha_kor(){$("#sonod_no").val(""),$("#tracking").val(""),$("#organization_name").val(""),$("#voucher").val(""),$("#pesha_kor").val("0.00"),$("#error_show").html(""),$("#pesha_kor_modal").modal("show")}function peshakor_data_search(){var a=$("#sonod_no").val();$.ajax({url:url+"/trade/get_pesha_kor_data",type:"POST",dataType:"JSON",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{sonod_no:a},success:function(a){"error"==a.status?($("#error_show").html(a.message),$("#tracking").val(""),$("#organization_name").val(""),$("#voucher").val(""),$("#pesha_kor").val("0.00")):($("#error_show").html(""),$("#tracking").val(a.data.tracking),$("#organization_name").val(a.data.organization_name_bn),$("#voucher").val(a.data.voucher))}})}function pesha_kor_save(){var a=$("#sonod_no").val(),t=$("#tracking").val(),e=$("#voucher").val(),n=$("#pesha_kor").val(),r=$("#payment_date").val(),o=!1;if(""==a?($("#sonod_no_error").html("সনদ নাম্বার প্রদান করুন"),o=!0):$("#sonod_no_error").html(""),0==n?($("#pesha_kor_error").html("কর প্রদান করুন"),o=!0):$("#pesha_kor_error").html(""),0!=o)return!1;$.ajax({url:url+"/trade/pesha_kor_save",type:"POST",dataType:"JSON",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{sonod_no:a,tracking:t,voucher:e,pesha_kor:n,payment_date:r},success:function(a){$("#pesha_kor_modal").modal("hide"),"success"==a.status?(swal({title:"ধন্যবাদ",text:a.message,type:a.status,showCancelButton:!0,cancelButtonText:"বাতিল",showConfirmButton:!0,confirmButtonText:"<a  href='peshakor_money_receipt/"+a.sonod_no+"' target='_blank'>প্রিন্ট</a>",closeOnConfirm:!0,allowEscapeKey:!1}),pesha_kors.ajax.reload()):(swal({title:"দুঃখিত",text:a.message,type:a.status,showCancelButton:!0,cancelButtonText:"বাতিল",showConfirmButton:!0,closeOnConfirm:!0,allowEscapeKey:!1}),pesha_kors.ajax.reload())}})}setTimeout((function(){$(".alert-success").hide("slow")}),3e3),$("#issue_date, #payment_date, #trade_generate_date, #from_date, #to_date").datepicker({language:"en",autoClose:!0,dateFormat:"yyyy-mm-dd"});
